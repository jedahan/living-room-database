{"version":3,"file":"RemoteClient.js","sources":["../src/parse.js","../src/AbstractClient.js","../src/terms.js","../src/RemoteClient.js"],"sourcesContent":["'use strict'\n\nconst ohm = require('ohm-js')\n\nconst grammar = ohm.grammar(`\n  G {\n\n    factOrPattern\n      = term*\n\n    term\n      = id\n      | word\n      | value\n      | variable\n      | wildcard\n      | hole\n\n    id\n      = \"#\" alnum*\n\n    value\n      = keyword<\"true\">   -- true\n      | keyword<\"false\">  -- false\n      | keyword<\"null\">   -- null\n      | number\n      | string\n\n    variable\n      = \"$\" alnum+\n\n    wildcard\n      = \"$\"\n\n    hole\n      = \"_\"\n\n    word\n      = (~special any)+  -- nonspace\n      | space+           -- space\n\n    keyword<k>\n      = k ~alnum\n\n    number\n      = float (\"e\" float)?\n\n    float\n      = integer (\".\" digit+)?\n\n    integer\n      = (\"+\" | \"-\")? digit+\n\n    string\n      = \"\\\\\"\" (~\"\\\\\"\" ~\"\\\\n\" any)* \"\\\\\"\"\n\n    special\n      = id | value | variable | wildcard | hole | space\n\n  }\n`)\n\nconst semantics = grammar.createSemantics().addOperation('parse', {\n  factOrPattern (terms) {\n    return terms.parse()\n  },\n  id (_, cs) {\n    return { id: cs.sourceString }\n  },\n  value_true (_) {\n    return { value: true }\n  },\n  value_false (_) {\n    return { value: false }\n  },\n  value_null (_) {\n    return { value: null }\n  },\n  variable (_, cs) {\n    return { variable: cs.sourceString }\n  },\n  wildcard (_) {\n    return { wildcard: true }\n  },\n  hole (_) {\n    return { hole: true }\n  },\n  word_nonspace (_) {\n    return { word: this.sourceString }\n  },\n  word_space (_) {\n    return { word: ' ' }\n  },\n  number (_1, _2, _3) {\n    return { value: parseFloat(this.sourceString) }\n  },\n  string (_oq, cs, _cq) {\n    const chars = []\n    let idx = 0\n    cs = cs.parse()\n    while (idx < cs.length) {\n      let c = cs[idx++]\n      if (c === '\\\\' && idx < cs.length) {\n        c = cs[idx++]\n        switch (c) {\n          case 'n':\n            c = '\\n'\n            break\n          case 't':\n            c = '\\t'\n            break\n          default:\n            idx--\n        }\n      }\n      chars.push(c)\n    }\n    return { value: chars.join('') }\n  },\n  _terminal () {\n    return this.sourceString\n  }\n})\n\nexport default function parse (str, optRule) {\n  const rule = optRule || 'factOrPattern'\n  const matchResult = grammar.match(str.trim(), rule)\n  if (matchResult.succeeded()) {\n    return semantics(matchResult).parse()\n  } else {\n    throw new Error(`invalid ${rule}: ${str}`)\n  }\n}\n","'use strict'\n\nimport parse from './parse'\n\nconst MAX_PARSE_CACHE_SIZE = 1000\n\nexport default class AbstractClient {\n  constructor (id) {\n    this._id = id\n    this._parseCache = new Map()\n    this._asserts = []\n    this._retracts = []\n  }\n\n  assert (factString, ...fillerValues) {\n    const fact = this._toJSONFactOrPattern(factString, ...fillerValues)\n    this._asserts.push(fact)\n  }\n\n  retract (patternString, ...fillerValues) {\n    const pattern = this._toJSONFactOrPattern(patternString, ...fillerValues)\n    this._retracts.push(pattern)\n  }\n\n  async flushChanges () {\n    throw new Error('subclass responsibility')\n  }\n\n  async immediatelyAssert (factString, ...fillerValues) {\n    this.assert(factString, ...fillerValues)\n    await this.flushChanges()\n  }\n\n  async immediatelyRetract (patternString, ...fillerValues) {\n    this.retract(patternString, ...fillerValues)\n    await this.flushChanges()\n  }\n\n  async immediatelyRetractEverythingAbout (name) {\n    throw new Error('subclass responsibility')\n  }\n\n  async immediatelyRetractEverythingAssertedByMe () {\n    throw new Error('subclass responsibility')\n  }\n\n  async getAllFacts () {\n    throw new Error('subclass responsibility')\n  }\n\n  _toJSONFactOrPattern (factOrPatternString, ...fillerValues) {\n    if (arguments.length === 0) {\n      throw new Error('not enough arguments!')\n    }\n    if (typeof factOrPatternString !== 'string') {\n      throw new Error('factOrPatternString must be a string!')\n    }\n    let terms = this._parse(factOrPatternString)\n    if (fillerValues.length > 0) {\n      terms = terms.slice()\n    }\n    for (let idx = 0; idx < terms.length; idx++) {\n      const term = terms[idx]\n      if (term.hasOwnProperty('hole')) {\n        if (fillerValues.length === 0) {\n          throw new Error('not enough filler values!')\n        }\n        terms[idx] = this._toJSONTerm(fillerValues.shift())\n      }\n    }\n    if (fillerValues.length > 0) {\n      throw new Error('too many filler values!')\n    }\n    return terms\n  }\n\n  _toJSONTerm (value) {\n    return { value: value }\n  }\n\n  _parse (factOrPatternString) {\n    if (this._parseCache.has(factOrPatternString)) {\n      return this._parseCache.get(factOrPatternString)\n    } else {\n      this._clearParseCacheIfTooBig()\n      const terms = parse(factOrPatternString)\n      this._parseCache.set(factOrPatternString, terms)\n      return terms\n    }\n  }\n\n  _clearParseCacheIfTooBig () {\n    if (this._parseCache.size > MAX_PARSE_CACHE_SIZE) {\n      this.clearParseCache()\n    }\n  }\n\n  clearParseCache () {\n    this._parseCache.clear()\n  }\n}\n","'use strict'\n\nclass Term {\n  toString () {\n    throw new Error('subclass responsibility')\n  }\n\n  toJSON () {\n    throw new Error('subclass responsibility')\n  }\n\n  toRawValue () {\n    throw new Error('subclass responsibility')\n  }\n\n  match (that, env) {\n    throw new Error('subclass responsibility')\n  }\n}\n\nTerm.fromJSON = json => {\n  if (json.hasOwnProperty('id')) {\n    return new Id(json.id)\n  } else if (json.hasOwnProperty('word')) {\n    return new Word(json.word)\n  } else if (json.hasOwnProperty('value')) {\n    return new Value(json.value)\n  } else if (json.hasOwnProperty('blobRef')) {\n    return new BlobRef(json.blobRef)\n  } else if (json.hasOwnProperty('variable')) {\n    return new Variable(json.variable)\n  } else if (json.hasOwnProperty('wildcard')) {\n    return new Wildcard()\n  } else if (json.hasOwnProperty('hole')) {\n    return new Hole()\n  } else {\n    throw new Error('unrecognized JSON term: ' + JSON.stringify(json))\n  }\n}\n\nclass Id extends Term {\n  constructor (name) {\n    super()\n    this.name = name\n  }\n\n  toString () {\n    return '#' + this.name\n  }\n\n  toJSON () {\n    return { id: this.name }\n  }\n\n  toRawValue () {\n    return this\n  }\n\n  match (that, env) {\n    return that instanceof Id && this.name === that.name ? env : null\n  }\n}\n\nclass Word extends Term {\n  constructor (value) {\n    super()\n    this.value = value\n  }\n\n  toString () {\n    return this.value\n  }\n\n  toJSON () {\n    return { word: this.value }\n  }\n\n  toRawValue () {\n    return this\n  }\n\n  match (that, env) {\n    return that instanceof Word && this.value === that.value ? env : null\n  }\n}\n\nclass Value extends Term {\n  constructor (value) {\n    super()\n    this.value = value\n  }\n\n  toString () {\n    return JSON.stringify(this.value)\n  }\n\n  toJSON () {\n    return { value: this.value }\n  }\n\n  toRawValue () {\n    return this.value\n  }\n\n  match (that, env) {\n    return that instanceof Value && this.value === that.value ? env : null\n  }\n}\n\nclass BlobRef extends Term {\n  constructor (id) {\n    super()\n    this.id = id\n  }\n\n  toString () {\n    return '@' + this.id\n  }\n\n  toJSON () {\n    return { blobRef: this.id }\n  }\n\n  toRawValue () {\n    return this\n  }\n\n  match (that, env) {\n    return that instanceof BlobRef && this.id === that.id ? env : null\n  }\n}\n\nclass Variable extends Term {\n  constructor (name) {\n    super()\n    this.name = name\n  }\n\n  toString () {\n    return '$' + this.name\n  }\n\n  toJSON () {\n    return { variable: this.name }\n  }\n\n  toRawValue () {\n    throw new Error(\"Variable's toRawValue() should never be called!\")\n  }\n\n  match (that, env) {\n    if (env[this.name] === undefined) {\n      env[this.name] = that\n      return env\n    } else {\n      return env[this.name].match(that, env)\n    }\n  }\n}\n\nclass Wildcard extends Term {\n  constructor () {\n    super()\n    // no-op\n  }\n\n  toString () {\n    return '$'\n  }\n\n  toJSON () {\n    return { wildcard: true }\n  }\n\n  toRawValue () {\n    throw new Error(\"Wildcard's toRawValue() should never be called!\")\n  }\n\n  match (that, env) {\n    return env\n  }\n}\n\nclass Hole extends Term {\n  constructor () {\n    super()\n    // no-op\n  }\n\n  toString () {\n    return '_'\n  }\n\n  toJSON () {\n    return { hole: true }\n  }\n\n  toRawValue () {\n    throw new Error(\"Hole's toRawValue() should never be called!\")\n  }\n\n  match (that, env) {\n    throw new Error(\"Hole's match() should never be called!\")\n  }\n}\n\nexport { Term, Id, Word, Value, BlobRef, Variable, Wildcard, Hole }\n","'use strict'\n\nimport AbstractClient from './AbstractClient'\nimport { Term } from './terms'\nimport parse from './parse'\n\n// If fetch is not declared, load it from the node-fetch module.\n// (This makes it possible to run RemoteClient in the browser and in node-js.)\nconst fetch = (() => {\n  try {\n    return fetch\n  } catch (e) {\n    return require('node-fetch')\n  }\n})()\n\nexport default class RemoteClient extends AbstractClient {\n  constructor (address, port, id) {\n    super(id)\n    this._address = address\n    this._port = port\n  }\n\n  select (...patternStrings) {\n    const patterns = patternStrings.map(\n      p =>\n        p instanceof Array\n          ? this._toJSONFactOrPattern(...p)\n          : this._toJSONFactOrPattern(p)\n    )\n    const solutions = async () => {\n      const params = `query=${JSON.stringify(patterns)}`\n      const response = await fetch(\n        `http://${this._address}:${this._port}/facts?${params}`\n      )\n      return await response.json()\n    }\n    const results = {\n      async do (callbackFn) {\n        for (let solution of await solutions()) {\n          for (let name in solution) {\n            // force serialization and deserialization to simulate going over the network\n            const json = JSON.parse(JSON.stringify(solution[name]))\n            solution[name] = Term.fromJSON(json).toRawValue()\n          }\n          await callbackFn(solution)\n        }\n        return results\n      },\n      async count () {\n        return (await solutions()).length\n      },\n      async isEmpty () {\n        return (await solutions()).length === 0\n      },\n      async isNotEmpty () {\n        return (await solutions()).length > 0\n      }\n    }\n    return results\n  }\n\n  async flushChanges () {\n    const retractions = this._retracts\n    const assertions = this._asserts\n    this._retracts = []\n    this._asserts = []\n    const params =\n      'clientId=' +\n      this._id +\n      '&' +\n      'retractions=' +\n      JSON.stringify(retractions) +\n      '&' +\n      'assertions=' +\n      JSON.stringify(assertions)\n    const response = await fetch(\n      `http://${this._address}:${this._port}/facts?${params}`,\n      { method: 'PUT' }\n    )\n    return await response.json()\n  }\n\n  async immediatelyRetractEverythingAbout (name) {\n    const response = await fetch(\n      `http://${this._address}:${this._port}/facts?clientId=${\n        this._id\n      }&name=${name}`,\n      { method: 'DELETE' }\n    )\n    return await response.json()\n  }\n\n  async immediatelyRetractEverythingAssertedByMe () {\n    const response = await fetch(\n      `http://${this._address}:${this._port}/facts?clientId=${this._id}`,\n      { method: 'DELETE' }\n    )\n    return await response.json()\n  }\n\n  async getAllFacts () {\n    const response = await fetch(`http://${this._address}:${this._port}/facts`)\n    return await response.json()\n  }\n\n  toString () {\n    return `[RemoteClient ${this._address}:${this._port}, ${this._id}]`\n  }\n}\n\nmodule.exports = RemoteClient\n"],"names":[],"mappings":"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"}